"""
Flash OS Routines (Automagically Generated)
Copyright (c) 2017-2017 ARM Limited

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
"""

from ...coresight.coresight_target import CoreSightTarget
from ...core.memory_map import FlashRegion, RamRegion, MemoryMap, RomRegion
from ...debug.svd.loader import SVDFile

FLASH_ALGO = {
    # Flash algorithm as a hex string
    "instructions": "00000000f0b541f2c606484b3d4d59f803303d4f1c68b4fbf5f41d687d43b6eb"
    "b51f1e68394d28bf04f1ff34b6fbf5f61d687d434fea7525b5f5067f1d68d3f8"
    "00c0b5fbf0f5bcfbf0fe00fb1ec098bf06f1ff3600b9013d44ea062440f23146"
    "44ea05442a4d6c6018682a4cb0fbf4f01c687c43b6eb342f1c681e68b4fbf1f4"
    "b6fbf1f701fb176628bf00f1ff3006b9013c214e196876682404f60549bf1f4e"
    "2043b1fbf6f101434bbf214340f4b060a960a8601968914217d2194991f83510"
    "090712d5174991f8cf001b681649b1fbf0f1b3fbf2f002fb1033b1fbf2f103b9"
    "013941f48031e960f0bd19681b68b1fbf2f1b3fbf2f002fb1033002bf3d10139"
    "f1e700bf40420f003961c26800127a000001004000093d00001b0040808d5b00"
    "0009044000080440006cdc0254000000f8b5654b59f803603368834200f09780"
    "624b584d59f80320614b574859f8031000f05efaa969554801f03f0141f48071"
    "00f014feab69d901fcd56969504801f03f0141f4805100f009fe4ff0804340f2"
    "03119a6a4b4f42f4807242f001029a629a6a494c0a439a62da6a0a43da62da6a"
    "22f48072da62da6a42f48072da62434a97f8351092f8cfc0207811f008015ffa"
    "8cfcc0b25ad1022842d04ff0010cd2f8bc004ff0804e20f4883040f48050c2f8"
    "bc0082f8cfc0d3f88000c3f88010da6f12074cbf6146c3f87cc04ff47a7c97f8"
    "35301b0707d4def8802033685b00b3fbfcf39a42f3d397f835304ff0804341b3"
    "4ff0000cd3f88020d3f880600244511e30444cf10007091a67f100008a427ceb"
    "000c22bf0222da674ff0ff32c3f880201b4a696ad3681b4823f00f0343f00903"
    "d36000f093fd0223236000f03dfd0020f8bd0222da67c3f88000e9e7bcf1010f"
    "e6d0022809d109210d4bd96000232370012382f8cf302070dae7012382f8cf30"
    "d6e700bf001b004000070800181b0040141b0040000904400001004000080440"
    "00080040241b0040540000005c00000058000000084b10b599420c460ad10846"
    "fff726ff034618b9c36a214698470346184610bd0423fbe7006cdc0200207047"
    "ff2a08b503d100235b6d984708bd0120fce708b50023db6c984708bd002108b5"
    "0b6d984708bdf8b500f07c037c2b164605460c464ff000020dd161b1136b3168"
    "984738b9012c05d00346076c321d611e281db847f8bd176c0023324621462846"
    "f7e700207047000030b510b3d0f8fc30114cb3f5803f34bf002203220f4b00f1"
    "fc0135bf1a601a604ff6ff724ff0ff325a6002468a4207d1d0f8fc00db69c01a"
    "18bf0120400130bd52f8045bc4f81856f0e70220f7e700bf0010004000160040"
    "2de9f8450446002800f01f81fff7ccff0022003818bf01209646904694461646"
    "174613464ff6ff7140016fb904eb830abaf80250adb22db1baf80250adb28d42"
    "40f0d68040f040006eb904eb830abaf81250adb22db1baf81250adb28d4240f0"
    "cb8040f40070bcf1000f0dd104eb830595f822a0baf1000f04d095f82250ff2d"
    "40f0be8040f48060b8f1000f0dd104eb830595f832a0baf1000f04d095f83250"
    "ff2d40f0b28040f48050bef1000f0dd104eb830abaf84050adb22db1baf84050"
    "adb28d4240f0a68040f480406ab904eb830abaf85250adb22db1baf85250adb2"
    "ff2d40f09c8040f400400133042b9cd1b4f872309bb233b14ff6ff72b4f87230"
    "9bb2934201d140f48020b4f882309bb2002b40f0888040f40020b4f88a309bb2"
    "002b40f0898040f40020b4f8a2309bb233b14ff6ff72b4f8a2309bb2934201d1"
    "40f48010b4f8b2309bb233b14ff6ff72b4f8b2309bb2934201d140f40010d4f8"
    "b8301bb1d4f8b430013301d140f40010d4f8c0301bb1d4f8c030013301d140f4"
    "8000b4f8d2309bb233b14ff6ff72b4f8d2309bb2934201d140f40000b4f8e230"
    "9bb20bb34ff6ff73b4f8e22092b29a421ad0b4f8e62092b2b2b1b4f8e62092b2"
    "9a4211d0b4f8e82092b26ab1b4f8e82092b29a4208d0b4f8ee2092b222b1b4f8"
    "ee2092b29a4201d140f00070bde8f885012720f0400027e7012620f4007032e7"
    "4ff0010c20f480603ee74ff0010820f480504ae74ff0010e20f4804056e70122"
    "20f4004061e74ff6ff72b4f882309bb293427ff472af6ee74ff6ff72b4f88a30"
    "9bb293427ff471af6de70220cee700002de9f8450e461546074630b3fff7d0fe"
    "830604461ed4dff8488005f1180af8446a68384655f8081b58f8043b98475545"
    "44ea0004f4d1dff82c80351ff844143655f8041f384658f8043b9847b54244ea"
    "0004f5d12046bde8f8850224fae700bf66180000301800002de9f041c0b3bbb3"
    "c2b300274ff6ff7e50f82740250cb4f1807fa84604f1ff3ca6b211d31cf1020f"
    "23d0a94203d0edb2a94204d1f6b200201e80bde8f081b1eb182f0fd1360af6e7"
    "1cf1030f94bf4ff0000c4ff0010c04f47f4454ea0c1408d1a942e8d00137ba42"
    "a3f800e0d0d10820e3e7edb2a942f4e70220dee70420dce7002313b5adf80630"
    "a8b104220df1060389b2a030fff7b4ff044648b9074b9df806105b6a064823f0"
    "7f03194300f032fb204602b010bd0224fae700bf001b0040241b0040002313b5"
    "adf8063000b308220df1060389b28030fff792ff0446a0b90c4b0d485a6abdf8"
    "063019049b0403f0c06301f4fe01194322f0df6323f4e023194341f4000100f0"
    "05fb204602b010bd0224fae7001b0040241b0040002313b5adf80630a0b10422"
    "0df1060389b27030fff766ff044640b9064b0748d969bdf8063063f3050100f0"
    "e5fa204602b010bd0224fae7001b00401c1b0040002313b5adf80630a0b10422"
    "0df1060389b25030fff746ff044668b9084b09485969bdf8063063f3050100f0"
    "c5fa204602b010bd0224fae748f20804f7e700bf001b0040141b0040002313b5"
    "adf80630a0b104220df1060389b24030fff722ff044640b9064b07489969bdf8"
    "063063f3050100f0a1fa204602b010bd0224fae7001b0040181b0040002313b5"
    "adf80630e0b104220df1060389b21030fff702ff044680b90a4bbdf806105b68"
    "094823f03f02db054cbf090ac9b2114300f07cfa204602b010bd40f40074f9e7"
    "0224f7e7001b0040041b0040002373b51646adf80430adf8063070b300f13005"
    "042201ab89b22846fff7d6fe041e18bf0124042228460df10603b1b22403fff7"
    "cbfe08b144f40054e20408d40c4b0d481969bdf8043063f3050100f047faa304"
    "08d4074b07481969bdf8063063f3154100f03cfa204602b070bd0224fae700bf"
    "001b0040101b0040002373b51646adf80430adf8063070b300f12005042201ab"
    "89b22846fff798fe041e18bf0124042228460df10603b1b2a402fff78dfe08b1"
    "44f40064620508d40c4b0d48d968bdf8043063f3050100f009fa230508d4074b"
    "0748d968bdf8063063f3154100f0fef9204602b070bd0224fae700bf001b0040"
    "0c1b0040002373b516460546adf80030adf80230002857d06b46042289b2fff7"
    "5bfe042204460df10203b1b2a818fff753fe28b18cb34ff4c074204602b070bd"
    "bdf802301a04002c40d1d5f8fc00bdf80010b0f5803f0fd29b0302f07f4203f4"
    "7f03134301f47f421343c1f3870119431b4800f0bbf9e0e7114301910199f7e7"
    "01689b0303f47f0302f07f42134389b2194300f0abf98024cfe7d5f8fc201048"
    "b2f5803fbdf800300e4a01684ff4807401ea02013ebf03f47f421143c3f38703"
    "194300f093f9b8e70224b6e7d5f8fc100348b1f5803fd3d3016889b21143d8e7"
    "001b00400000ffff08b1fff78bbf0220704708b1fff7e2be0220704708b1fff7"
    "43bf0220704708b1fff700bf0220704708b1fff78fbe0220704708b1fff7aebe"
    "022070474ff4002310b5d3f80036a3f13002d2b22a2a4fd81a0a303ad2b22a2a"
    "4ad81a0c303ad2b22a2a45d81b0e303b2a2b41d80222234b23481a604ff0ff32"
    "22495a60224a52f8044b8a42c0f81846f9d1da694ff40023d3f8fc1691422ed1"
    "d3f804160f2912d81a4b1b485b6823f4704343ea013100f029f900204ff40023"
    "d3f80816ff2905d940f0805010bd4ff00060f3e7114ad2f8b83023f07f4343ea"
    "0163c2f8b830d2f8b83023f47f0343ea0143c2f8b830e9e74ff08060e6e72020"
    "e4e700bf0016004000100040fc06080000060800001b0040041b004000080440"
    "08b1fff7f7bd0220704708b1fff7c6bd0220704708b1fff79fbd0220704710b4"
    "0c46042c11461a4626d008d8022c1bd0032c1dd0a4b95df8044bfff755bf082c"
    "26d007d8052c1bd0072c1dd000205df8044b7047092cf9d15df8044bfff7dabf"
    "5df8044bfff745bf5df8044bfff746bf5df8044bfff747bf5df8044bfff74dbf"
    "5df8044bfff744bf5df8044bfff7b8bf5df8044bfff7b9bf70b5134604460d46"
    "16460a4601460648fff7b9ff38b133462a462146bde870400248fff7b0bf70bd"
    "000408000007080013b5e8b100230222adf80630d0300df10603fff7fdfc0446"
    "78b90a4bbdf80620d3f88430084923f4732301ea022123f470630648194300f0"
    "75f8204602b010bd0224fae7001b0040003f0f00841b004010b588b181b17ab1"
    "03685c1e03340dd80469013c033409d8dbb20b6003690020c3f30903136010bd"
    "0220fce70820fae71e49274b0a6859f8033002f00702022a24d018d8fab91a4a"
    "516a01f0c061b1f1007f14d0b1f1806f13d0164a1648002918bf02461a60154a"
    "506b10f080401bd11968c36a1847032a13d00f4af2e7104af0e7104aeee74ff4"
    "0042ebe70e4a92f8cf100029f1d092f8cf100c4ab2fbf1f2e0e749780131f8e7"
    "704700bf00010040001b0040c0c62d00404b4c0000080040001bb70000366e01"
    "00080440006cdc02540000000cb4eff310834ff0010282f3108820f04002bff3"
    "6f8f0160d27883f310880cbc70470000010152534c3135203531320000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000100000000000000080000080000"
    "00000000ff00000064000000b80b000000010000000408000001000000050800"
    "0001000000060800000100000007080000800500000010000080020000801500"
    "ffffffffffffffff000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "0000000000000000000000000000000000000000000000000000000000000000"
    "00000000000000000000000000000000780000006e000000a0000000a0000000"
    "b80b0000008000004b0000006400000073000000500000007300000050000000"
    "5d0800001d080000d5070000950700003d070000f9060000a509000029090000"
    "ad08000000000000501e0000681e000000000000000000000000000000000000",
    # Relative function addresses
    "pc_init": 0x2D5,
    "pc_unInit": 0x2FD,
    "pc_program_page": 0x327,
    "pc_erase_sector": 0x31D,
    "pc_eraseAll": 0x313,
    # Relative region addresses and sizes
    "ro_start": 0x0,
    "ro_size": 0x1E50,
    "rw_start": 0x1E50,
    "rw_size": 0x70,
    "zi_start": 0x1EC0,
    "zi_size": 0x0,
    # Flash information
    "flash_start": 0x0,
    "flash_size": 0x80000,
    "page_size": 0x800,
    "sector_sizes": (
        (0x80400, 0x100),
        (0x80500, 0x100),
        (0x80600, 0x100),
        (0x80700, 0x100),
        (0x100000, 0x58000),
        (0x158000, 0x28000),
    ),
}


class RSL15_512(CoreSightTarget):
    VENDOR = "onsemi"

    MEMORY_MAP = MemoryMap(
        RomRegion(start=0x00000000, length=32 * 1024, access="rx"),     # ROM
        FlashRegion(start=0x00080400, length=0x00100, blocksize=256),   # NVR4
        FlashRegion(start=0x00080500, length=0x00100, blocksize=256),   # NVR5
        FlashRegion(start=0x00080600, length=0x00100, blocksize=256),   # NVR6
        FlashRegion(start=0x00080700, length=0x00100, blocksize=256),   # NVR7
        FlashRegion(                                                    # CODE
            start=0x00100000,
            length=0x58000,
            blocksize=2048,
            is_boot_memory=True,
        ),
        FlashRegion(start=0x00158000, length=0x28000, blocksize=256),   # DATA
        RamRegion(start=0x20000000, length=64 * 1024, access="rwx"),    # SRAM
        RamRegion(start=0x20010000, length=16 * 1024, access="rwx"),    # BBSRAM
    )

    def __init__(self, session):
        super(RSL15_512, self).__init__(session, self.MEMORY_MAP)
        self._svd_location = SVDFile.from_builtin("RSL15.svd")
